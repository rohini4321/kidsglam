<%-include('../partials/header.ejs')%>

<%-include('../partials/topnav.ejs')%>

<main class="main">
    <div class="page-header breadcrumb-wrap">
        <div class="container">
            <div class="breadcrumb">
                <a href="index.html" rel="nofollow">Home</a>
                <span></span> Shop
            </div>
        </div>
    </div>
    <section class="mt-50 mb-50">
        <div class="container">
            <div class="row flex-row-reverse">
                <div class="col-lg-9">
                    <div class="shop-product-fillter">
                        <div class="totall-product">
                            <!-- <p> We found <strong class="text-brand">688</strong> items for you!</p> -->
                        </div>
                        <div class="sort-by-product-area">
                            <div class="sort-by-cover mr-10">
                                <div class="sort-by-product-wrap">
                                    <div class="sort-by">
                                        <!-- <span><i class="fi-rs-apps"></i>Show:</span> -->
                                    </div>
                                </div>
                            </div>
                            <div class="sort-by-cover">
                                <div class="sort-by-product-wrap">
                                </div>
                            </div>
                            <div class="row product-grid-3">
                                <% if(product.length > 0) { %>
                                    <% for(let i = 0; i < product.length; i++) { %>
                                        <div class="col-lg-4 col-md-4 col-12 col-sm-6 product-card" data-category="<%= product[i].category %>" data-name="<%= product[i].productName %>" data-price="<%= product[i].price %>">
                                            <div class="product-cart-wrap mb-30">
                                                <div class="product-img-action-wrap">
                                                    <div class="product-img product-img-zoom">
                                                        <a href="/singleproduct?id=<%=product[i].id%>">
                                                            <img class="default-img" src="/uploads/<%=product[i].image[0]%>" alt="">
                                                            <img class="hover-img" src="userAssets/imgs/shop/product-2-2.jpg" alt="">
                                                        </a>
                                                    </div>
                                                    <div class="product-action-1">
                                                        <a aria-label="Quick view" class="action-btn hover-up" data-bs-toggle="modal" data-bs-target="#quickViewModal">
                                                            <i class="fi-rs-search"></i>
                                                        </a>
                                                        <a aria-label="Add To Wishlist" class="action-btn hover-up" href="shop-wishlist.html">
                                                            <i class="fi-rs-heart"></i>
                                                        </a>
                                                        <a aria-label="Compare" class="action-btn hover-up" href="shop-compare.html">
                                                            <i class="fi-rs-shuffle"></i>
                                                        </a>
                                                    </div>
                                                    <div class="product-badges product-badges-position product-badges-mrg">
                                                        <span class="hot">Hot</span>
                                                    </div>
                                                </div>
                                                <div class="product-content-wrap">
                                                    <div class="product-category">
                                                        <a href="shop-grid-right.html"><%=product[i].category%></a>
                                                    </div>
                                                    <h2><a href="shop-product-right.html"><%=product[i].productName%></a></h2>
                                                    <div class="rating-result" title="90%">
                                                        <span>
                                                            <span>90%</span>
                                                        </span>
                                                    </div>
                                                    <div class="product-price">
                                                        <span>Rs.<%=product[i].price%></span>
                                                        <!-- <span class="old-price">$245.8</span> -->
                                                    </div>
                                                    <div class="product-action-1 show">
                                                        <a aria-label="Add To Cart" data-id="<%=product[i].id%>" class="action-btn hover-up add-to-cart-btn">
                                                            <i class="fi-rs-shopping-bag-add"></i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    <% } %>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    <!--pagination-->
                    <div class="pagination-area mt-15 mb-sm-5 mb-lg-0">
                        <nav aria-label="Page navigation example">
                            <div class="pagination-area mt-15 mb-sm-5 mb-lg-0">
                                <nav aria-label="Page navigation example">
                                  <ul class="pagination justify-content-start">
                                    <% if (page > 1) { %>
                                      <li class="page-item">
                                        <a class="page-link" href="?page=<%= page - 1 %>&limit=<%= limit %>"><i class="fi-rs-angle-double-small-left"></i></a>
                                      </li>
                                    <% } %>
                                    <% for (let i = 1; i <= totalPages; i++) { %>
                                      <li class="page-item <%= page === i ? 'active' : '' %>">
                                        <a class="page-link" href="?page=<%= i %>&limit=<%= limit %>"><%= i %></a>
                                      </li>
                                    <% } %>
                                    <% if (page < totalPages) { %>
                                      <li class="page-item">
                                        <a class="page-link" href="?page=<%= page + 1 %>&limit=<%= limit %>"><i class="fi-rs-angle-double-small-right"></i></a>
                                      </li>
                                    <% } %>
                                  </ul>
                                </nav>
                              </div>
                        </nav>
                    </div>
                </div>
                <div class="col-lg-3 primary-sidebar sticky-sidebar">
                    <div class="widget-category mb-30">
                        <h5 class="section-title style-1 mb-30 wow fadeIn animated">Category</h5>
                        <ul class="categories">
                            <li data-category="All">
                                <a href="javascript:void(0)">All</a>
                            </li>
                            <% if(category.length > 0) { %>
                                <% for(let i = 0; i < category.length; i++) { %>
                                    <li data-category="<%= category[i].categoryName %>">
                                        <a href="javascript:void(0)"><%= category[i].categoryName %></a>
                                    </li>
                                <% } %>
                            <% } %> 
                        </ul>
                    </div>
                    <!-- Sort by -->
                    <div class="widget-sort-by mb-30">
                        <h5 class="section-title style-1 mb-30 wow fadeIn animated">Sort By</h5>
                        <select id="sort-by" class="form-select">
                            <option value="default">Default</option>
                            <option value="name-asc">Name: A to Z</option>
                            <option value="name-desc">Name: Z to A</option>
                            <option value="price-asc">Price: Low to High</option>
                            <option value="price-desc">Price: High to Low</option>
                        </select>
                    </div>
                    <!-- Product sidebar Widget -->
                    <div class="sidebar-widget product-sidebar mb-30 p-30 bg-grey border-radius-10">
                        <div class="widget-header position-relative mb-20 pb-10">
                            <h5 class="widget-title mb-10">New products</h5>
                            <div class="bt-1 border-color-1"></div>
                        </div>
                        <div class="single-post clearfix">
                            <div class="image">
                                <img src="userAssets/imgs/shop/thumbnail-3.jpg" alt="#">
                            </div>
                            <div class="content pt-10">
                                <h5><a href="shop-product-detail.html">Chen Cardigan</a></h5>
                                <p class="price mb-0 mt-5">$99.50</p>
                                <div class="product-rate">
                                    <div class="product-rating" style="width:90%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="single-post clearfix">
                            <div class="image">
                                <img src="userAssets/imgs/shop/thumbnail-4.jpg" alt="#">
                            </div>
                            <div class="content pt-10">
                                <h6><a href="shop-product-detail.html">Chen Sweater</a></h6>
                                <p class="price mb-0 mt-5">$89.50</p>
                                <div class="product-rate">
                                    <div class="product-rating" style="width:80%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="single-post clearfix">
                            <div class="image">
                                <img src="userAssets/imgs/shop/thumbnail-5.jpg" alt="#">
                            </div>
                            <div class="content pt-10">
                                <h6><a href="shop-product-detail.html">Colorful Jacket</a></h6>
                                <p class="price mb-0 mt-5">$25</p>
                                <div class="product-rate">
                                    <div class="product-rating" style="width:60%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="banner-img wow fadeIn mb-45 animated d-lg-block d-none">
                        <img src="userAssets/imgs/banner/banner-11.jpg" alt="">
                        <div class="banner-text">
                            <span>Women Zone</span>
                            <h4>Save 17% on <br>Office Dress</h4>
                            <a href="shop-grid-right.html">Shop Now <i class="fi-rs-arrow-right"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<%-include('../partials/bottomnav.ejs')%>
<%- include('../partials/footer.ejs') %>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
  const categoryItems = document.querySelectorAll('.categories li');
  const productCards = document.querySelectorAll('.product-card');
  const sortBySelect = document.getElementById('sort-by');

  addToCartButtons.forEach(button => {
    button.addEventListener('click', async () => {
      const productId = button.getAttribute('data-id');
      console.log("the productid", productId);

      try {
        const response = await fetch('/addCart', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ productId }),
        });

        const data = await response.json();

        if (data.success) {
          window.location.href = '/getCart'; // Redirect to the cart page
        } else {
          alert('Failed to add product to cart');
        }
      } catch (error) {
        console.error('Error adding product to cart:', error);
        alert('Failed to add product to cart');
      }
    });
  });

  categoryItems.forEach(item => {
    item.addEventListener('click', () => {
      const category = item.getAttribute('data-category');
      filterProducts(category);
    });
  });

  sortBySelect.addEventListener('change', () => {
    const sortBy = sortBySelect.value;
    sortProducts(sortBy);
  });

  function filterProducts(category) {
    productCards.forEach(card => {
      if (category === 'All' || card.getAttribute('data-category') === category) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });
  }

  function sortProducts(sortBy) {
    const sortedCards = Array.from(productCards).sort((a, b) => {
      const nameA = a.getAttribute('data-name').toLowerCase();
      const nameB = b.getAttribute('data-name').toLowerCase();
      const priceA = parseFloat(a.getAttribute('data-price'));
      const priceB = parseFloat(b.getAttribute('data-price'));

      if (sortBy === 'name-asc') {
        return nameA.localeCompare(nameB);
      } else if (sortBy === 'name-desc') {
        return nameB.localeCompare(nameA);
      } else if (sortBy === 'price-asc') {
        return priceA - priceB;
      } else if (sortBy === 'price-desc') {
        return priceB - priceA;
      } else {
        return 0;
      }
    });

    const productGrid = document.querySelector('.product-grid-3');
    productGrid.innerHTML = '';
    sortedCards.forEach(card => {
      productGrid.appendChild(card);
    });
  }
});
</script>
